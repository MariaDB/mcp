
version: "3.8"

services:
  mariadb-server:
    image: mariadb:11
    container_name: mariadb
    environment:
      MARIADB_ROOT_PASSWORD: rootpassword123
      MARIADB_DATABASE: demo
      MARIADB_USER: user
      MARIADB_PASSWORD: password123
    ports:
      - "3306:3306"
    healthcheck:
      test: ["CMD-SHELL", "mariadb-admin ping -h 127.0.0.1 -u root -prootpassword123 || exit 1"]
      interval: 5s
      timeout: 3s
      retries: 10

  mariadb-mcp:
    build: .
    container_name: mariadb-mcp
    env_file: .env
    ports:
      - "9001:9001"
    depends_on:
      - mariadb-server
    healthcheck:
      test: ["CMD-SHELL", "python -c \"import socket; s=socket.socket(); s.settimeout(3); s.connect(('localhost', 9001)); s.close()\""]
      interval: 10s
      timeout: 5s
      retries: 5

